<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TF Jacksonville Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: white;
        }

        .loading-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .loading-screen.hidden { display: none; }
        .loader {
            width: 50px; height: 50px;
            border: 4px solid rgba(78, 205, 196, 0.3);
            border-top-color: #4ecdc4; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .auth-screen {
            min-height: 100vh; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px;
        }
        .auth-screen.hidden { display: none; }
        .auth-logo { font-size: 48px; margin-bottom: 10px; }
        .auth-title {
            font-size: 24px; font-weight: 800; margin-bottom: 5px;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .auth-subtitle { color: #888; margin-bottom: 30px; text-align: center; }
        .auth-box {
            background: rgba(255,255,255,0.05); border-radius: 20px;
            padding: 30px; width: 100%; max-width: 400px;
        }
        .auth-tabs {
            display: flex; margin-bottom: 20px;
            background: rgba(0,0,0,0.2); border-radius: 12px; padding: 4px;
        }
        .auth-tab {
            flex: 1; padding: 12px; border: none; background: transparent;
            color: #888; font-family: 'Poppins', sans-serif; font-weight: 600;
            font-size: 14px; cursor: pointer; border-radius: 10px;
        }
        .auth-tab.active {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white;
        }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; color: #aaa; margin-bottom: 6px; }
        .form-group input {
            width: 100%; padding: 12px 14px;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px; color: white; font-family: 'Poppins', sans-serif; font-size: 14px;
        }
        .form-group input:focus { outline: none; border-color: #4ecdc4; }
        .auth-btn {
            width: 100%; padding: 14px;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            border: none; border-radius: 12px; color: white;
            font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 15px; cursor: pointer;
        }
        .auth-btn:disabled { opacity: 0.6; }
        .auth-divider { text-align: center; color: #666; margin: 20px 0; }
        .google-btn {
            width: 100%; padding: 12px; background: white; border: none;
            border-radius: 12px; color: #333; font-family: 'Poppins', sans-serif;
            font-weight: 500; font-size: 14px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .google-btn svg { width: 20px; height: 20px; }
        .auth-error {
            background: rgba(255,100,100,0.2); color: #ff6b6b;
            padding: 10px; border-radius: 8px; font-size: 13px; margin-bottom: 15px; display: none;
        }
        .auth-error.show { display: block; }

        .app-container { display: none; min-height: 100vh; padding-bottom: 80px; }
        .app-container.active { display: block; }

        .app-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 16px; background: rgba(0,0,0,0.3);
            position: sticky; top: 0; z-index: 50;
        }
        .header-logo { font-size: 16px; font-weight: 700; color: #4ecdc4; }
        .header-user { display: flex; align-items: center; gap: 10px; }
        .user-points {
            background: rgba(78,205,196,0.2); color: #4ecdc4;
            padding: 5px 12px; border-radius: 20px; font-size: 13px; font-weight: 600;
        }
        .multiplier-badge {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #000; padding: 3px 8px; border-radius: 10px;
            font-size: 11px; font-weight: 700;
        }
        .user-avatar {
            width: 34px; height: 34px; border-radius: 50%;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 13px; cursor: pointer;
        }

        .view { display: none; padding: 16px; max-width: 600px; margin: 0 auto; }
        .view.active { display: block; }

        /* Dashboard */
        .countdown-row {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;
        }
        .countdown-card {
            background: rgba(255,255,255,0.05); border-radius: 14px;
            padding: 16px; text-align: center;
        }
        .countdown-card.urgent { background: linear-gradient(135deg, rgba(255,100,100,0.2), rgba(255,100,100,0.1)); }
        .countdown-card.event { background: linear-gradient(135deg, rgba(78,205,196,0.2), rgba(78,205,196,0.1)); }
        .countdown-value { font-size: 32px; font-weight: 800; }
        .countdown-card.urgent .countdown-value { color: #ff6b6b; }
        .countdown-card.event .countdown-value { color: #4ecdc4; }
        .countdown-label { font-size: 11px; color: #888; margin-top: 4px; }

        .streak-card {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            border-radius: 20px; padding: 24px; text-align: center; margin-bottom: 16px;
        }
        .streak-row { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .streak-stat { text-align: center; }
        .streak-number { font-size: 42px; font-weight: 800; line-height: 1; }
        .streak-label { font-size: 12px; opacity: 0.9; }
        .streak-multiplier {
            background: rgba(255,255,255,0.2); padding: 8px 16px;
            border-radius: 12px; font-weight: 700;
        }

        .daily-challenge {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,140,0,0.1));
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 16px; padding: 16px; margin-bottom: 16px;
        }
        .daily-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
        }
        .daily-title { font-size: 14px; font-weight: 700; color: #ffd700; }
        .daily-timer { font-size: 12px; color: #ffa500; }
        .daily-task { font-size: 14px; margin-bottom: 8px; }
        .daily-points {
            display: inline-block; background: rgba(255,215,0,0.3);
            padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; color: #ffd700;
        }

        .stats-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05); border-radius: 14px; padding: 16px; text-align: center;
        }
        .stat-value { font-size: 24px; font-weight: 700; color: #4ecdc4; }
        .stat-label { font-size: 11px; color: #888; margin-top: 4px; }

        .milestones-section { margin-bottom: 20px; }
        .section-title { font-size: 16px; font-weight: 700; margin-bottom: 12px; }
        .milestone-item {
            display: flex; align-items: center; gap: 12px;
            background: rgba(255,255,255,0.03); border-radius: 12px;
            padding: 12px; margin-bottom: 8px;
        }
        .milestone-item.achieved { background: rgba(78,205,196,0.15); }
        .milestone-icon { font-size: 24px; }
        .milestone-info { flex: 1; }
        .milestone-name { font-size: 13px; font-weight: 600; }
        .milestone-desc { font-size: 11px; color: #888; }
        .milestone-points {
            background: rgba(78,205,196,0.2); color: #4ecdc4;
            padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;
        }
        .milestone-item.achieved .milestone-points { background: #4ecdc4; color: #000; }

        /* Tasks View */
        .phase-tabs {
            display: flex; gap: 8px; overflow-x: auto; padding-bottom: 12px; margin-bottom: 16px;
        }
        .phase-tab {
            padding: 8px 14px; background: rgba(255,255,255,0.08);
            border: none; border-radius: 20px; color: #888;
            font-family: 'Poppins', sans-serif; font-size: 12px; font-weight: 600;
            white-space: nowrap; cursor: pointer;
        }
        .phase-tab.active { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; }
        .phase-tab.locked { opacity: 0.4; }

        .task-category {
            background: rgba(255,255,255,0.05); border-radius: 16px;
            padding: 16px; margin-bottom: 16px;
        }
        .category-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
        }
        .category-title { font-size: 14px; font-weight: 700; color: #4ecdc4; }
        .category-progress { font-size: 12px; color: #888; }

        .task-item {
            display: flex; align-items: flex-start; gap: 12px;
            padding: 12px; background: rgba(255,255,255,0.03);
            border-radius: 12px; margin-bottom: 8px; cursor: pointer;
        }
        .task-item:hover { background: rgba(255,255,255,0.06); }
        .task-item.completed { opacity: 0.5; }
        .task-item.hard { border-left: 3px solid #ff6b6b; }
        .task-checkbox {
            width: 24px; height: 24px; border: 2px solid #4ecdc4;
            border-radius: 6px; display: flex; align-items: center;
            justify-content: center; flex-shrink: 0;
        }
        .task-item.completed .task-checkbox { background: #4ecdc4; }
        .task-checkbox svg { width: 14px; height: 14px; stroke: white; stroke-width: 3; opacity: 0; }
        .task-item.completed .task-checkbox svg { opacity: 1; }
        .task-content { flex: 1; }
        .task-title { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
        .task-item.completed .task-title { text-decoration: line-through; }
        .task-desc { font-size: 11px; color: #888; line-height: 1.4; }
        .task-meta { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }
        .task-points-badge {
            background: rgba(78,205,196,0.2); color: #4ecdc4;
            padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 600;
        }
        .task-points-badge.high { background: rgba(255,107,107,0.2); color: #ff6b6b; }
        .task-proof-badge {
            background: rgba(255,200,100,0.2); color: #ffc864;
            padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 600;
        }
        .task-proof-badge.uploaded { background: rgba(100,255,150,0.2); color: #64ff96; }

        /* Leaderboard */
        .leaderboard-header { text-align: center; margin-bottom: 20px; }
        .leaderboard-title { font-size: 20px; font-weight: 800; }
        .leaderboard-subtitle { color: #888; font-size: 13px; }

        .podium { display: flex; justify-content: center; align-items: flex-end; gap: 8px; margin-bottom: 24px; }
        .podium-place { text-align: center; flex: 1; max-width: 100px; }
        .podium-avatar {
            width: 50px; height: 50px; border-radius: 50%; margin: 0 auto 8px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 18px; position: relative;
        }
        .podium-place:nth-child(2) .podium-avatar { width: 60px; height: 60px; font-size: 22px; }
        .podium-medal { position: absolute; bottom: -4px; right: -4px; font-size: 16px; }
        .podium-name { font-size: 12px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .podium-points { font-size: 11px; color: #4ecdc4; font-weight: 600; }
        .podium-bar { margin-top: 8px; border-radius: 6px 6px 0 0; }
        .podium-place:nth-child(1) .podium-bar { height: 50px; background: linear-gradient(180deg, #c0c0c0, #8a8a8a); }
        .podium-place:nth-child(2) .podium-bar { height: 70px; background: linear-gradient(180deg, #ffd700, #b8860b); }
        .podium-place:nth-child(3) .podium-bar { height: 40px; background: linear-gradient(180deg, #cd7f32, #8b4513); }
        .podium-place:nth-child(1) .podium-avatar { background: linear-gradient(135deg, #c0c0c0, #8a8a8a); }
        .podium-place:nth-child(2) .podium-avatar { background: linear-gradient(135deg, #ffd700, #b8860b); }
        .podium-place:nth-child(3) .podium-avatar { background: linear-gradient(135deg, #cd7f32, #8b4513); }

        .leaderboard-list { background: rgba(255,255,255,0.05); border-radius: 16px; overflow: hidden; }
        .leaderboard-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .leaderboard-item:last-child { border-bottom: none; }
        .leaderboard-item.current-user { background: rgba(78,205,196,0.1); }
        .leaderboard-rank { width: 40px; font-weight: 700; color: #888; font-size: 13px; display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .rank-trend { font-size: 9px; font-weight: 600; }
        .rank-trend.up { color: #4ecdc4; }
        .rank-trend.down { color: #ff6b6b; }
        .leaderboard-avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 13px;
        }
        .leaderboard-info { flex: 1; }
        .leaderboard-name { font-size: 13px; font-weight: 600; }
        .leaderboard-streak { font-size: 11px; color: #888; }
        .leaderboard-points { font-weight: 700; color: #4ecdc4; font-size: 14px; }

        /* Profile */
        .profile-header { text-align: center; padding: 24px 0; }
        .profile-avatar {
            width: 80px; height: 80px; border-radius: 50%;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 32px; margin: 0 auto 12px;
        }
        .profile-name { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
        .profile-email { color: #888; font-size: 13px; }
        .profile-badges { display: flex; gap: 8px; justify-content: center; margin-top: 12px; flex-wrap: wrap; }
        .badge {
            background: rgba(78,205,196,0.2); color: #4ecdc4;
            padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600;
        }
        .badge.gold { background: rgba(255,215,0,0.2); color: #ffd700; }

        .profile-stats {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 24px 0;
        }
        .profile-stat {
            background: rgba(255,255,255,0.05); border-radius: 14px; padding: 16px; text-align: center;
        }
        .profile-stat-value { font-size: 22px; font-weight: 700; color: #4ecdc4; }
        .profile-stat-label { font-size: 10px; color: #888; margin-top: 4px; }

        .profile-section { background: rgba(255,255,255,0.05); border-radius: 14px; margin-bottom: 12px; }
        .profile-option {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer;
        }
        .profile-option:last-child { border-bottom: none; }
        .profile-option:hover { background: rgba(255,255,255,0.03); }
        .profile-option-icon { font-size: 18px; }
        .profile-option-text { flex: 1; font-size: 13px; }
        .profile-option-arrow { color: #666; }

        .logout-btn {
            width: 100%; padding: 14px;
            background: rgba(255,100,100,0.2); border: none; border-radius: 12px;
            color: #ff6b6b; font-family: 'Poppins', sans-serif; font-weight: 600;
            font-size: 14px; cursor: pointer; margin-top: 16px;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(26,26,46,0.98); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around;
            padding: 8px 0 20px; border-top: 1px solid rgba(255,255,255,0.05);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 2px;
            padding: 6px 14px; border: none; background: transparent;
            color: #666; font-family: 'Poppins', sans-serif; font-size: 10px; cursor: pointer;
        }
        .nav-item.active { color: #4ecdc4; }
        .nav-item svg { width: 22px; height: 22px; }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85); display: none;
            align-items: center; justify-content: center; z-index: 200; padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: #1a1a2e; border-radius: 20px; padding: 24px;
            width: 100%; max-width: 400px; max-height: 85vh; overflow-y: auto;
        }
        .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
        .modal-desc { color: #888; font-size: 13px; margin-bottom: 20px; line-height: 1.5; }
        .upload-area {
            border: 2px dashed rgba(78,205,196,0.5); border-radius: 14px;
            padding: 32px 16px; text-align: center; cursor: pointer; margin-bottom: 16px;
        }
        .upload-area:hover { border-color: #4ecdc4; background: rgba(78,205,196,0.05); }
        .upload-area.has-file { border-color: #4ecdc4; background: rgba(78,205,196,0.1); }
        .upload-icon { font-size: 40px; margin-bottom: 8px; }
        .upload-text { color: #888; font-size: 13px; }
        .upload-preview { max-width: 100%; max-height: 180px; border-radius: 10px; margin-top: 12px; }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btn {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 14px; cursor: pointer;
        }
        .modal-btn.primary { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; }
        .modal-btn.secondary { background: rgba(255,255,255,0.1); color: white; }

        .toast {
            position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: #333; color: white; padding: 12px 20px; border-radius: 10px;
            font-size: 13px; z-index: 300; opacity: 0; transition: all 0.3s ease;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); }
        .toast.error { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%); }

        /* === ANIMATIONS === */
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes checkmark-pop { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        @keyframes points-float { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-40px); } }
        @keyframes confetti-fall { 0% { transform: translateY(-10px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        @keyframes glow-pulse { 0%, 100% { box-shadow: 0 0 5px rgba(78,205,196,0.3); } 50% { box-shadow: 0 0 20px rgba(78,205,196,0.6); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slide-down { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        /* === MICRO-INTERACTIONS === */
        .auth-btn, .modal-btn, .phase-tab, .google-btn { transition: transform 0.15s ease, box-shadow 0.2s ease; }
        .auth-btn:active, .modal-btn:active, .google-btn:active { transform: scale(0.96); }
        .phase-tab:active { transform: scale(0.95); }
        .nav-item { transition: transform 0.1s ease; }
        .nav-item:active { transform: scale(0.9); }
        .stat-card, .countdown-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .stat-card:active, .countdown-card:active { transform: scale(0.97); }

        /* === CONFETTI === */
        .confetti-particle {
            position: fixed; top: -10px; z-index: 9999;
            pointer-events: none; animation: confetti-fall linear forwards;
        }
        .confetti-particle.circle { width: 10px; height: 10px; border-radius: 50%; }
        .confetti-particle.square { width: 8px; height: 8px; }
        .confetti-particle.strip { width: 4px; height: 16px; border-radius: 2px; }

        /* === FLOATING POINTS === */
        .floating-points {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 24px; font-weight: 800; color: #4ecdc4;
            text-shadow: 0 2px 10px rgba(78,205,196,0.5);
            animation: points-float 1s ease-out forwards; pointer-events: none; z-index: 100;
        }

        /* === ACHIEVEMENT POPUP === */
        .achievement-popup {
            position: fixed; top: 100px; left: 50%; transform: translateX(-50%) translateY(-30px);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #ffd700; border-radius: 20px;
            padding: 20px 28px; display: flex; align-items: center; gap: 16px;
            z-index: 1000; opacity: 0; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 50px rgba(255,215,0,0.4);
        }
        .achievement-popup.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .achievement-popup .ach-icon { font-size: 44px; animation: bounce 0.6s ease infinite; }
        .achievement-popup .ach-label { font-size: 11px; color: #ffd700; text-transform: uppercase; letter-spacing: 2px; }
        .achievement-popup .ach-name { font-size: 18px; font-weight: 700; margin-top: 2px; }

        /* === COMBO INDICATOR === */
        .combo-indicator {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.5);
            background: linear-gradient(135deg, #ff6b6b 0%, #ffd700 100%);
            border-radius: 20px; padding: 20px 40px; text-align: center;
            z-index: 1000; opacity: 0; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .combo-indicator.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .combo-indicator .combo-label { font-size: 28px; font-weight: 800; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .combo-indicator .combo-bonus { display: block; font-size: 14px; color: rgba(255,255,255,0.9); margin-top: 4px; }

        /* === LEVEL BADGE === */
        .level-badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(255,255,255,0.1); border: 2px solid #4ecdc4;
            border-radius: 30px; padding: 6px 14px; margin-top: 12px;
        }
        .level-badge .level-num { font-size: 12px; font-weight: 700; color: #4ecdc4; }
        .level-badge .level-title { font-size: 12px; color: #fff; }
        .level-progress { width: 100%; max-width: 200px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin: 10px auto 4px; overflow: hidden; }
        .level-progress-fill { height: 100%; background: linear-gradient(90deg, #4ecdc4, #ffd700); border-radius: 3px; transition: width 0.5s ease; }
        .level-next { font-size: 11px; color: #888; }

        /* === ACTIVITY FEED === */
        .activity-item {
            display: flex; align-items: flex-start; gap: 12px;
            padding: 14px; background: rgba(255,255,255,0.03);
            border-radius: 14px; margin-bottom: 10px;
            animation: slide-up 0.3s ease;
        }
        .activity-item.is-me { background: rgba(78,205,196,0.08); }
        .activity-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 14px; flex-shrink: 0;
        }
        .activity-content { flex: 1; }
        .activity-text { font-size: 13px; line-height: 1.4; }
        .activity-text strong { color: #4ecdc4; }
        .activity-meta { display: flex; gap: 12px; margin-top: 6px; font-size: 11px; color: #888; }
        .activity-reactions { display: flex; gap: 6px; flex-shrink: 0; }
        .reaction-btn {
            padding: 4px 10px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
            color: #888; font-size: 12px; cursor: pointer; transition: all 0.2s ease;
        }
        .reaction-btn:hover { background: rgba(255,255,255,0.1); }
        .reaction-btn.active { background: rgba(78,205,196,0.2); border-color: #4ecdc4; color: #4ecdc4; }

        /* === ENHANCED TASK CARDS === */
        .task-item {
            display: flex; align-items: flex-start; gap: 14px;
            padding: 16px; background: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.06); border-radius: 16px;
            margin-bottom: 10px; cursor: pointer; position: relative; overflow: hidden;
            transition: all 0.25s ease;
        }
        .task-item::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(78,205,196,0.15), transparent);
            opacity: 0; transition: opacity 0.25s ease;
        }
        .task-item:hover::before { opacity: 1; }
        .task-item:active { transform: scale(0.98); }
        .task-item.completed { opacity: 0.5; }
        .task-item.completed::after {
            content: '‚úì'; position: absolute; top: 10px; right: 14px;
            font-size: 18px; color: #4ecdc4;
        }
        .task-item.hard {
            border-left: 4px solid #ff6b6b;
            background: linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,255,255,0.03) 100%);
        }
        .task-checkbox {
            width: 28px; height: 28px; border: 2px solid rgba(78,205,196,0.5);
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; background: rgba(78,205,196,0.1); transition: all 0.2s ease;
        }
        .task-item.completed .task-checkbox {
            background: linear-gradient(135deg, #4ecdc4, #44a08d); border-color: transparent;
        }
        .task-item.completed .task-checkbox svg { animation: checkmark-pop 0.4s ease; }

        /* === LEADERBOARD TRENDS === */
        .trend-up { color: #4ecdc4; font-size: 10px; margin-left: 4px; }
        .trend-down { color: #ff6b6b; font-size: 10px; margin-left: 4px; }
        .trend-same { color: #888; font-size: 10px; margin-left: 4px; }

        /* === ACHIEVEMENTS GRID === */
        .achievements-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 16px; }
        .achievement-item {
            background: rgba(255,255,255,0.05); border-radius: 14px;
            padding: 14px 10px; text-align: center; position: relative;
        }
        .achievement-item.locked { opacity: 0.4; }
        .achievement-item.locked::after {
            content: 'üîí'; position: absolute; top: 8px; right: 8px; font-size: 12px;
        }
        .achievement-item .ach-icon { font-size: 28px; margin-bottom: 6px; }
        .achievement-item .ach-name { font-size: 11px; font-weight: 600; }
        .achievement-item.unlocked { border: 1px solid rgba(255,215,0,0.3); }
        .achievement-item.unlocked .ach-icon { animation: pulse 2s ease infinite; }
    </style>
</head>
<body>
    <div class="loading-screen" id="loading-screen"><div class="loader"></div></div>

    <div class="auth-screen" id="auth-screen">
        <div class="auth-logo">üèÉ‚Äç‚ôÇÔ∏è</div>
        <h1 class="auth-title">TF Jacksonville</h1>
        <p class="auth-subtitle">Fundraising Challenge</p>
        <div class="auth-box">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthForm('login')">Sign In</button>
                <button class="auth-tab" onclick="showAuthForm('signup')">Sign Up</button>
            </div>
            <div class="auth-error" id="auth-error"></div>
            <form class="auth-form active" id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="auth-btn" id="login-btn">Sign In</button>
            </form>
            <form class="auth-form" id="signup-form" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="signup-name" placeholder="Your name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signup-email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signup-password" placeholder="Min 6 characters" required minlength="6">
                </div>
                <button type="submit" class="auth-btn" id="signup-btn">Create Account</button>
            </form>
            <div class="auth-divider">or</div>
            <button class="google-btn" onclick="handleGoogleLogin()">
                <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Continue with Google
            </button>
        </div>
    </div>

    <div class="app-container" id="app-container">
        <header class="app-header">
            <div class="header-logo">TF Jacksonville</div>
            <div class="header-user">
                <span class="multiplier-badge" id="multiplier-badge" style="display:none">1.25x</span>
                <div class="user-points" id="header-points">0 pts</div>
                <div class="user-avatar" id="header-avatar" onclick="showView('profile')">?</div>
            </div>
        </header>

        <div class="view active" id="dashboard-view">
            <div class="countdown-row">
                <div class="countdown-card urgent">
                    <div class="countdown-value" id="deadline-days">--</div>
                    <div class="countdown-label">Days to Deadline (Jan 21)</div>
                </div>
                <div class="countdown-card event">
                    <div class="countdown-value" id="event-days">--</div>
                    <div class="countdown-label">Days to Event (Jan 30)</div>
                </div>
            </div>

            <div class="streak-card">
                <div class="streak-row">
                    <div class="streak-stat">
                        <div class="streak-number" id="dash-streak">0</div>
                        <div class="streak-label">Day Streak</div>
                    </div>
                    <div class="streak-multiplier" id="streak-multiplier">1x Points</div>
                    <div class="streak-stat">
                        <div class="streak-number" id="dash-points">0</div>
                        <div class="streak-label">Total Points</div>
                    </div>
                </div>
            </div>

            <div class="daily-challenge" id="daily-challenge">
                <div class="daily-header">
                    <span class="daily-title">üî• Challenge of the Day</span>
                    <span class="daily-timer" id="daily-timer">Ends in --:--</span>
                </div>
                <div class="daily-task" id="daily-task">Loading...</div>
                <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
                    <span class="daily-points" id="daily-points">+0 BONUS pts</span>
                    <button id="daily-complete-btn" onclick="completeDailyChallenge()" style="padding:6px 14px; background:linear-gradient(135deg,#ffd700,#ff8c00); border:none; border-radius:8px; color:#000; font-family:'Poppins',sans-serif; font-weight:600; font-size:12px; cursor:pointer;">Complete</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card" onclick="showView('tasks')" style="cursor:pointer">
                    <div class="stat-value" id="dash-tasks">0</div>
                    <div class="stat-label">Tasks Done</div>
                </div>
                <div class="stat-card" onclick="showView('leaderboard')" style="cursor:pointer">
                    <div class="stat-value" id="dash-rank">#--</div>
                    <div class="stat-label">Leaderboard</div>
                </div>
            </div>

            <div class="milestones-section">
                <h3 class="section-title">Fundraising Milestones</h3>
                <div id="milestones-list"></div>
            </div>
        </div>

        <div class="view" id="tasks-view">
            <div class="phase-tabs" id="phase-tabs"></div>
            <div id="tasks-content"></div>
        </div>

        <div class="view" id="leaderboard-view">
            <div class="leaderboard-header">
                <h2 class="leaderboard-title">Leaderboard</h2>
                <p class="leaderboard-subtitle">Top fundraising challengers</p>
            </div>
            <div class="podium" id="podium"></div>
            <div class="leaderboard-list" id="leaderboard-list"></div>
        </div>

        <div class="view" id="feed-view">
            <div class="leaderboard-header">
                <h2 class="leaderboard-title">Activity Feed</h2>
                <p class="leaderboard-subtitle">See what your team is up to</p>
            </div>
            <div id="activity-feed">
                <div style="text-align:center; padding:40px; color:#888;">Loading activity...</div>
            </div>
        </div>

        <div class="view" id="profile-view">
            <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar">?</div>
                <h2 class="profile-name" id="profile-name">Runner</h2>
                <p class="profile-email" id="profile-email">email@example.com</p>
                <div id="level-badge-container"></div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profile-points">0</div>
                    <div class="profile-stat-label">Points</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profile-streak">0</div>
                    <div class="profile-stat-label">Streak</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profile-tasks">0</div>
                    <div class="profile-stat-label">Tasks</div>
                </div>
            </div>
            <div class="profile-section">
                <div class="profile-option" onclick="editName()">
                    <span class="profile-option-icon">‚úèÔ∏è</span>
                    <span class="profile-option-text">Edit Name</span>
                    <span class="profile-option-arrow">‚Ä∫</span>
                </div>
                <div class="profile-option" onclick="window.location.href='index.html'">
                    <span class="profile-option-icon">üìö</span>
                    <span class="profile-option-text">Fundraising Course</span>
                    <span class="profile-option-arrow">‚Ä∫</span>
                </div>
                <div class="profile-option" onclick="shareProfile()">
                    <span class="profile-option-icon">üîó</span>
                    <span class="profile-option-text">Share Progress</span>
                    <span class="profile-option-arrow">‚Ä∫</span>
                </div>
            </div>
            <div class="profile-section">
                <h3 style="color:#fff;margin:0 0 12px;font-size:16px;">Achievements</h3>
                <div class="achievements-grid" id="achievements-grid"></div>
            </div>
            <button class="logout-btn" onclick="handleLogout()">Sign Out</button>
        </div>

        <nav class="bottom-nav">
            <button class="nav-item active" onclick="showView('dashboard')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                Home
            </button>
            <button class="nav-item" onclick="showView('tasks')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                Tasks
            </button>
            <button class="nav-item" onclick="showView('leaderboard')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                Rank
            </button>
            <button class="nav-item" onclick="showView('feed')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
                Feed
            </button>
            <button class="nav-item" onclick="showView('profile')">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                Profile
            </button>
        </nav>
    </div>

    <div class="modal-overlay" id="upload-modal">
        <div class="modal">
            <h3 class="modal-title" id="modal-task-title">Upload Proof</h3>
            <p class="modal-desc" id="modal-task-desc">Screenshot or photo showing you completed this task</p>
            <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                <div class="upload-icon">üì∑</div>
                <div class="upload-text">Tap to select image</div>
                <img class="upload-preview" id="upload-preview" style="display:none">
            </div>
            <input type="file" id="file-input" accept="image/*" style="display:none" onchange="handleFileSelect(event)">
            <div class="modal-btns">
                <button class="modal-btn secondary" onclick="closeModal()">Cancel</button>
                <button class="modal-btn primary" id="submit-proof-btn" onclick="submitProof()" disabled>Submit</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBK5Y7oKleZLUnUFoOLaRB_cXNmvKEDRRY",
            authDomain: "team-friendship.firebaseapp.com",
            projectId: "team-friendship",
            storageBucket: "team-friendship.firebasestorage.app",
            messagingSenderId: "747924547341",
            appId: "1:747924547341:web:57669d47e1f61d3a833244"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // PHASES AND TASKS
        const phases = [
            { id: 1, name: "Re-Ask & Recruit", dates: "Start here" },
            { id: 2, name: "Expand Your Circle", dates: "Level 2" },
            { id: 3, name: "Final Push", dates: "Level 3" },
            { id: 4, name: "Event & Gratitude", dates: "Level 4" }
        ];

        const tasks = [
            // PHASE 1: Go Back to the Well (Jan 13-16)
            { id: "1-1", phase: 1, title: "The Re-Ask", desc: "Message 3 people who already donated and ask if they'd consider adding to their gift. Screenshot the convos.", points: 25, hard: true },
            { id: "1-2", phase: 1, title: "The Recruiter Ask", desc: "Ask 3 donors to each text ONE friend about your campaign. Provide them the exact text.", points: 20 },
            { id: "1-3", phase: 1, title: "The Match Hunt", desc: "Ask 5 donors if their company matches charitable gifts. Screenshot proof you asked.", points: 20, bonus: "50 pts if you find a match!" },
            { id: "1-4", phase: 1, title: "The Specific Amount Ask", desc: "Text 5 people asking for a SPECIFIC amount - '$50 would mean so much' not 'anything helps'.", points: 20 },
            { id: "1-5", phase: 1, title: "The $100 Ask", desc: "Ask someone specifically for $100. Screenshot the ask - yes or no doesn't matter.", points: 25, hard: true },
            { id: "1-6", phase: 1, title: "Post Your Stretch Goal", desc: "Share on social: 'I hit my minimum, now going for $X because [reason].' Tag Team Friendship.", points: 15 },
            { id: "1-7", phase: 1, title: "The Call Challenge", desc: "Make 5 actual phone CALLS about fundraising. Not texts. Screenshot call log.", points: 30, hard: true },

            // PHASE 2: Expand the Circle (Jan 17-18)
            { id: "2-1", phase: 2, title: "The LinkedIn Post", desc: "Post about your fundraising on LinkedIn. This is where $250 donors live.", points: 30, hard: true },
            { id: "2-2", phase: 2, title: "The Boss Ask", desc: "Ask your boss or senior colleague to donate OR share with their network. Screenshot.", points: 35, hard: true },
            { id: "2-3", phase: 2, title: "The Vendor/Client Ask", desc: "Ask a vendor, client, or business contact to donate.", points: 25 },
            { id: "2-4", phase: 2, title: "The 'I Need Help' Post", desc: "Post a genuine, vulnerable ask. Not polished. Real. 'I'm nervous to ask but...'", points: 25 },
            { id: "2-5", phase: 2, title: "Voice Note Blitz", desc: "Send 10 personalized voice note asks. Say their name, say why you thought of them.", points: 30 },
            { id: "2-6", phase: 2, title: "Parent/Sibling Share", desc: "Ask a parent or sibling to post YOUR link on THEIR social media.", points: 20, bonus: "+15 if they do it!" },

            // PHASE 3: Final 72 Hours (Jan 19-21)
            { id: "3-1", phase: 3, title: "Countdown Blitz - Day 3", desc: "Post '3 days left!' update with your link.", points: 10 },
            { id: "3-2", phase: 3, title: "Countdown Blitz - Day 2", desc: "Post '2 days left!' update with your link.", points: 10 },
            { id: "3-3", phase: 3, title: "Countdown Blitz - Final Day", desc: "Post 'Final day!' update with your link.", points: 10 },
            { id: "3-4", phase: 3, title: "The 'Almost There' Push", desc: "If within $200 of stretch goal, post exactly how much you need.", points: 20 },
            { id: "3-5", phase: 3, title: "Non-Responder Follow-Up", desc: "Message everyone who saw but didn't donate. 'Just circling back...' Screenshot 10+ messages.", points: 25 },
            { id: "3-6", phase: 3, title: "Final Hour Ask", desc: "On Jan 21, post a 'last chance' message in the final 6 hours.", points: 15 },
            { id: "3-7", phase: 3, title: "The Hail Mary Call", desc: "Call your biggest potential donor who hasn't given. The one you've been nervous to call.", points: 30, hard: true },
            { id: "3-8", phase: 3, title: "The Gratitude Bomb", desc: "Post thanking donors by first name publicly. Creates social proof!", points: 20 },

            // PHASE 4: Event Week (Jan 22-30)
            { id: "4-1", phase: 4, title: "Share Final Total", desc: "Share your final fundraising total with a gratitude post.", points: 20 },
            { id: "4-2", phase: 4, title: "Packing/Prep Post", desc: "Post about packing or preparing for Jacksonville.", points: 10 },
            { id: "4-3", phase: 4, title: "Excitement Post", desc: "Share what you're most excited about.", points: 15 },
            { id: "4-4", phase: 4, title: "Thank Every Donor", desc: "Send individual thank you messages. Screenshot proof of at least 10.", points: 30 },
            { id: "4-5", phase: 4, title: "Travel/Arrival Content", desc: "Post travel or arrival content.", points: 15 },
            { id: "4-7", phase: 4, title: "Race Day Posts", desc: "Share race day photos and updates.", points: 25 },
            { id: "4-8", phase: 4, title: "Post-Race Reflection", desc: "Share your post-race reflection.", points: 25 },
            { id: "4-9", phase: 4, title: "Testimonial", desc: "'What this meant to me' testimonial post.", points: 30 },

            // UNCOMFORTABLE CHALLENGES (Always available, high points)
            { id: "u-1", phase: 0, title: "Go Live", desc: "Do an Instagram/Facebook live about why you're running. Ask for donations in real-time.", points: 50, hard: true, category: "uncomfortable" },
            { id: "u-2", phase: 0, title: "The Video Ask", desc: "Record a personal video asking for donations. Post it publicly.", points: 35, hard: true, category: "uncomfortable" },
            { id: "u-3", phase: 0, title: "The 'I Hate Asking' Post", desc: "Write a post starting with 'I hate asking for money, but...' Be genuine.", points: 30, category: "uncomfortable" },
            { id: "u-4", phase: 0, title: "Text Your Whole Contact List", desc: "Send your link to 50+ contacts at once via group text or broadcast. Screenshot.", points: 40, hard: true, category: "uncomfortable" },

            // TEAM CHALLENGES
            { id: "t-1", phase: 0, title: "The Tag Team", desc: "Get another TF runner to share YOUR page, you share THEIRS.", points: 15, category: "team" },
            { id: "t-2", phase: 0, title: "Donor Hot Potato", desc: "Ask one of your donors to make a small donation ($18-36) to another runner.", points: 25, category: "team" }
        ];

        // DAILY CHALLENGES (rotate based on date)
        const dailyChallenges = [
            { date: "2026-01-13", task: "Make 3 phone calls about your fundraising today", points: 40 },
            { date: "2026-01-14", task: "Send 5 personalized voice notes asking for donations", points: 35 },
            { date: "2026-01-15", task: "Ask someone for exactly $100", points: 45 },
            { date: "2026-01-16", task: "Post a video of yourself talking about why you're running", points: 50 },
            { date: "2026-01-17", task: "Make a LinkedIn post about your fundraising", points: 40 },
            { date: "2026-01-18", task: "Ask your boss or a senior colleague to donate", points: 45 },
            { date: "2026-01-19", task: "Follow up with 10 people who haven't responded", points: 35 },
            { date: "2026-01-20", task: "Go live on social media for at least 2 minutes", points: 60 },
            { date: "2026-01-21", task: "Post 3 'last chance' messages throughout the day", points: 40 },
            { date: "2026-01-22", task: "Send thank you messages to all your donors", points: 35 },
            { date: "2026-01-23", task: "Share your final fundraising total publicly", points: 30 }
        ];

        // MILESTONES
        const milestones = [
            { id: "m1", name: "Goal Crusher", desc: "Hit 100% of minimum ($2,800)", amount: 2800, points: 50, icon: "üéØ" },
            { id: "m2", name: "Overachiever", desc: "Hit $3,500 (25% over)", amount: 3500, points: 75, icon: "‚≠ê" },
            { id: "m3", name: "Champion", desc: "Hit $4,000 (43% over)", amount: 4000, points: 100, icon: "üèÜ" },
            { id: "m4", name: "Legend", desc: "Hit $5,000+", amount: 5000, points: 150, icon: "üëë" }
        ];

        let currentUser = null;
        let userData = null;
        let currentTaskId = null;
        let selectedFile = null;
        let currentPhase = 1;

        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            auth.onAuthStateChanged(async user => {
                document.getElementById('loading-screen').classList.add('hidden');
                if (user) {
                    currentUser = user;
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (!userDoc.exists) {
                        await db.collection('users').doc(user.uid).set({
                            name: user.displayName || user.email.split('@')[0],
                            email: user.email,
                            points: 0,
                            streak: 1,
                            multiplier: 1,
                            lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                            completedTasks: [],
                            dailyCompleted: [],
                            proofs: {},
                            badges: [],
                            fundraised: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    loadUserData();
                } else {
                    document.getElementById('auth-screen').classList.remove('hidden');
                    document.getElementById('app-container').classList.remove('active');
                }
            });
        });

        // AUTH
        function showAuthForm(form) {
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(form + '-form').classList.add('active');
            event.target.classList.add('active');
            document.getElementById('auth-error').classList.remove('show');
        }

        function showAuthError(msg) {
            const el = document.getElementById('auth-error');
            el.textContent = msg;
            el.classList.add('show');
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const btn = document.getElementById('login-btn');
            btn.disabled = true;
            btn.textContent = 'Signing in...';

            setTimeout(() => { if (auth.currentUser) window.location.reload(); }, 3000);

            auth.signInWithEmailAndPassword(email, password)
                .then(() => window.location.reload())
                .catch(err => {
                    showAuthError(err.message);
                    btn.disabled = false;
                    btn.textContent = 'Sign In';
                });
        }

        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const btn = document.getElementById('signup-btn');
            btn.disabled = true;
            btn.textContent = 'Creating account...';

            setTimeout(() => { if (auth.currentUser) window.location.reload(); }, 3000);

            auth.createUserWithEmailAndPassword(email, password)
                .then(cred => {
                    cred.user.updateProfile({ displayName: name }).then(() => window.location.reload());
                })
                .catch(err => {
                    showAuthError(err.message);
                    btn.disabled = false;
                    btn.textContent = 'Create Account';
                });
        }

        function handleGoogleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(err => showAuthError(err.message));
        }

        function handleLogout() { auth.signOut(); }

        // USER DATA
        async function loadUserData() {
            const doc = await db.collection('users').doc(currentUser.uid).get();
            if (doc.exists) {
                userData = doc.data();
                await checkStreak();
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.add('active');
                updateUI();
                renderPhaseTabs();
                renderTasks();
                loadLeaderboard();
            }
        }

        async function checkStreak() {
            if (!userData.lastActive) return;
            const lastActive = userData.lastActive.toDate();
            const now = new Date();
            const lastDay = new Date(lastActive.getFullYear(), lastActive.getMonth(), lastActive.getDate());
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const diffDays = Math.floor((today - lastDay) / (1000 * 60 * 60 * 24));

            let newStreak = userData.streak || 1;
            let multiplier = 1;

            if (diffDays === 0) {
                // Same day, keep streak
                newStreak = userData.streak;
            } else if (diffDays === 1) {
                // Next day, increment streak
                newStreak = (userData.streak || 0) + 1;
            } else {
                // Missed days, reset
                newStreak = 1;
            }

            // Calculate multiplier (3+ days = 1.25x)
            multiplier = newStreak >= 3 ? 1.25 : 1;

            await db.collection('users').doc(currentUser.uid).update({
                streak: newStreak,
                multiplier: multiplier,
                lastActive: firebase.firestore.FieldValue.serverTimestamp()
            });

            userData.streak = newStreak;
            userData.multiplier = multiplier;
        }

        function updateUI() {
            const initial = (userData.name || 'U')[0].toUpperCase();
            const completedCount = userData.completedTasks?.length || 0;

            // Header
            document.getElementById('header-points').textContent = Math.round(userData.points || 0) + ' pts';
            document.getElementById('header-avatar').textContent = initial;

            // Multiplier badge
            const multBadge = document.getElementById('multiplier-badge');
            if (userData.multiplier > 1) {
                multBadge.style.display = 'inline';
                multBadge.textContent = userData.multiplier + 'x';
            } else {
                multBadge.style.display = 'none';
            }

            // Countdowns
            const today = new Date();
            const deadline = new Date('2026-01-21');
            const eventDay = new Date('2026-01-30');
            const deadlineDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
            const eventDays = Math.ceil((eventDay - today) / (1000 * 60 * 60 * 24));
            document.getElementById('deadline-days').textContent = deadlineDays > 0 ? deadlineDays : (deadlineDays === 0 ? 'TODAY!' : 'DONE');
            document.getElementById('event-days').textContent = eventDays > 0 ? eventDays : (eventDays === 0 ? 'TODAY!' : 'DONE');

            // Dashboard
            document.getElementById('dash-streak').textContent = userData.streak || 0;
            document.getElementById('dash-points').textContent = Math.round(userData.points || 0);
            document.getElementById('streak-multiplier').textContent = (userData.multiplier || 1) + 'x Points';
            document.getElementById('dash-tasks').textContent = completedCount;

            // Daily Challenge
            updateDailyChallenge();

            // Milestones
            renderMilestones();

            // Profile
            document.getElementById('profile-avatar').textContent = initial;
            document.getElementById('profile-name').textContent = userData.name || 'Runner';
            document.getElementById('profile-email').textContent = userData.email || '';
            document.getElementById('profile-points').textContent = Math.round(userData.points || 0);
            document.getElementById('profile-streak').textContent = userData.streak || 0;
            document.getElementById('profile-tasks').textContent = completedCount;

            // Level Badge
            document.getElementById('level-badge-container').innerHTML = renderLevelBadge();

            // Achievements Grid
            renderAchievementsGrid();
        }

        function renderAchievementsGrid() {
            const userAch = userData.achievements || {};
            const grid = document.getElementById('achievements-grid');
            grid.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = !!userAch[ach.id];
                return `
                    <div class="achievement ${unlocked ? 'unlocked' : 'locked'}" title="${ach.desc}">
                        <span class="ach-icon">${ach.icon}</span>
                        <span class="ach-name">${ach.name}</span>
                    </div>
                `;
            }).join('');
        }

        function updateDailyChallenge() {
            const today = new Date().toISOString().split('T')[0];
            const daily = dailyChallenges.find(d => d.date === today);

            if (daily) {
                document.getElementById('daily-task').textContent = daily.task;
                const displayPoints = Math.round(daily.points * (userData.multiplier || 1));
                document.getElementById('daily-points').textContent = '+' + displayPoints + ' BONUS pts';

                // Timer until midnight
                const now = new Date();
                const midnight = new Date(now);
                midnight.setHours(24, 0, 0, 0);
                const diff = midnight - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById('daily-timer').textContent = `Ends in ${hours}h ${mins}m`;

                // Check if already completed
                const btn = document.getElementById('daily-complete-btn');
                if (userData.dailyCompleted?.includes(today)) {
                    btn.textContent = '‚úì Done';
                    btn.disabled = true;
                    btn.style.background = 'rgba(100,255,150,0.3)';
                    btn.style.color = '#64ff96';
                } else {
                    btn.textContent = 'Complete';
                    btn.disabled = false;
                    btn.style.background = 'linear-gradient(135deg,#ffd700,#ff8c00)';
                    btn.style.color = '#000';
                }
            } else {
                document.getElementById('daily-challenge').style.display = 'none';
            }
        }

        function renderMilestones() {
            const fundraised = userData.fundraised || 0;
            const html = milestones.map(m => {
                const achieved = fundraised >= m.amount;
                return `
                    <div class="milestone-item ${achieved ? 'achieved' : ''}">
                        <div class="milestone-icon">${m.icon}</div>
                        <div class="milestone-info">
                            <div class="milestone-name">${m.name}</div>
                            <div class="milestone-desc">${m.desc}</div>
                        </div>
                        <div class="milestone-points">${achieved ? '‚úì ' : ''}+${m.points}</div>
                    </div>
                `;
            }).join('');
            document.getElementById('milestones-list').innerHTML = html;
        }

        // TASKS
        function renderPhaseTabs() {
            const html = phases.map(p => {
                return `
                    <button class="phase-tab ${currentPhase === p.id ? 'active' : ''}"
                            onclick="selectPhase(${p.id})">
                        ${p.name}
                    </button>
                `;
            }).join('');

            // Add special challenges tab
            const specialHtml = `
                <button class="phase-tab ${currentPhase === 0 ? 'active' : ''}" onclick="selectPhase(0)">
                    üî• Bonus
                </button>
            `;

            document.getElementById('phase-tabs').innerHTML = html + specialHtml;
        }

        function selectPhase(phaseId) {
            currentPhase = phaseId;
            renderPhaseTabs();
            renderTasks();
        }

        function renderTasks() {
            let phaseTasks;
            if (currentPhase === 0) {
                phaseTasks = tasks.filter(t => t.phase === 0);
            } else {
                phaseTasks = tasks.filter(t => t.phase === currentPhase);
            }

            // Group by category for phase 0
            if (currentPhase === 0) {
                const uncomfortable = phaseTasks.filter(t => t.category === 'uncomfortable');
                const team = phaseTasks.filter(t => t.category === 'team');

                let html = '';
                if (uncomfortable.length) {
                    html += renderTaskCategory('üî• Uncomfortable (High Points)', uncomfortable);
                }
                if (team.length) {
                    html += renderTaskCategory('ü§ù Team Challenges', team);
                }
                document.getElementById('tasks-content').innerHTML = html;
            } else {
                const phase = phases.find(p => p.id === currentPhase);
                const completed = phaseTasks.filter(t => userData.completedTasks?.includes(t.id)).length;
                let html = renderTaskCategory(phase?.name || `Phase ${currentPhase}`, phaseTasks, `${completed}/${phaseTasks.length}`);

                // Add message if all tasks completed
                if (completed === phaseTasks.length && phaseTasks.length > 0) {
                    html += `
                        <div style="text-align:center; padding:20px; background:rgba(78,205,196,0.1); border-radius:16px; margin-top:16px;">
                            <div style="font-size:24px; margin-bottom:8px;">üéâ</div>
                            <div style="font-weight:600; color:#4ecdc4;">All Done!</div>
                            <div style="color:#888; font-size:13px; margin-top:4px;">Try the üî• Bonus challenges or another category!</div>
                        </div>
                    `;
                }
                document.getElementById('tasks-content').innerHTML = html;
            }
        }

        function renderTaskCategory(title, taskList, progress = '') {
            const tasksHtml = taskList.map(task => {
                const isCompleted = userData.completedTasks?.includes(task.id);
                const hasProof = userData.proofs?.[task.id];
                const displayPoints = Math.round(task.points * (userData.multiplier || 1));

                return `
                    <div class="task-item ${isCompleted ? 'completed' : ''} ${task.hard ? 'hard' : ''}" onclick="openTaskModal('${task.id}')">
                        <div class="task-checkbox">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                            <div class="task-desc">${task.desc}</div>
                            <div class="task-meta">
                                <span class="task-points-badge ${task.hard ? 'high' : ''}">+${displayPoints} pts</span>
                                ${task.bonus ? `<span class="task-points-badge">${task.bonus}</span>` : ''}
                                ${hasProof ? '<span class="task-proof-badge uploaded">‚úì Proof</span>' : '<span class="task-proof-badge">Upload proof</span>'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="task-category">
                    <div class="category-header">
                        <div class="category-title">${title}</div>
                        ${progress ? `<div class="category-progress">${progress}</div>` : ''}
                    </div>
                    ${tasksHtml}
                </div>
            `;
        }

        function openTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            // Check if already completed
            if (userData.completedTasks?.includes(taskId)) {
                showToast('Task already completed!', 'success');
                return;
            }

            currentTaskId = taskId;
            selectedFile = null;

            document.getElementById('modal-task-title').textContent = task.title;
            document.getElementById('modal-task-desc').textContent = task.desc + ' Upload a screenshot to earn ' + Math.round(task.points * (userData.multiplier || 1)) + ' points!';
            document.getElementById('upload-preview').style.display = 'none';
            document.getElementById('upload-area').classList.remove('has-file');
            document.querySelector('#upload-area .upload-text').textContent = 'Tap to select image';
            document.getElementById('submit-proof-btn').disabled = true;
            document.getElementById('submit-proof-btn').textContent = 'Submit';
            document.getElementById('file-input').value = '';

            document.getElementById('upload-modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('upload-modal').classList.remove('show');
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('upload-preview').src = e.target.result;
                document.getElementById('upload-preview').style.display = 'block';
                document.getElementById('upload-area').classList.add('has-file');
                document.querySelector('#upload-area .upload-text').textContent = file.name;
                document.getElementById('submit-proof-btn').disabled = false;
            };
            reader.readAsDataURL(file);
        }

        async function submitProof() {
            if (!selectedFile || !currentTaskId) return;

            // Check if already completed - prevent points farming
            const alreadyCompleted = userData.completedTasks?.includes(currentTaskId);
            if (alreadyCompleted) {
                showToast('Task already completed!', 'error');
                closeModal();
                return;
            }

            const btn = document.getElementById('submit-proof-btn');
            btn.disabled = true;
            btn.textContent = 'Uploading...';

            try {
                const fileRef = storage.ref(`proofs/${currentUser.uid}/${currentTaskId}_${Date.now()}`);
                await fileRef.put(selectedFile);
                const downloadUrl = await fileRef.getDownloadURL();

                const task = tasks.find(t => t.id === currentTaskId);
                const points = Math.round((task?.points || 10) * (userData.multiplier || 1));

                const updates = {
                    [`proofs.${currentTaskId}`]: downloadUrl,
                    points: firebase.firestore.FieldValue.increment(points),
                    completedTasks: firebase.firestore.FieldValue.arrayUnion(currentTaskId),
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(currentUser.uid).update(updates);

                userData.proofs = userData.proofs || {};
                userData.proofs[currentTaskId] = downloadUrl;
                userData.points = (userData.points || 0) + points;
                userData.completedTasks = userData.completedTasks || [];
                userData.completedTasks.push(currentTaskId);

                // Handle combo bonus
                const comboBonus = await handleCombo();
                const totalPoints = points + comboBonus;

                // Post to activity feed
                postActivity('task_complete', {
                    taskName: task?.title || 'Task',
                    points: totalPoints
                });

                // Check for level up
                const oldLevel = getUserLevel((userData.points || 0) - totalPoints);
                const newLevel = getUserLevel(userData.points || 0);
                if (newLevel.level > oldLevel.level) {
                    Confetti.burst(80);
                    postActivity('level_up', { newLevel: newLevel.level, points: 0 });
                    showToast(`üéâ Level Up! You're now ${newLevel.title}!`, 'success');
                }

                // Check achievements
                await checkAchievements();

                closeModal();
                updateUI();
                renderTasks();

                // Visual feedback
                Confetti.burst(30);
                showToast(`+${totalPoints} points earned!${comboBonus > 0 ? ` (${comboBonus} combo bonus!)` : ''}`, 'success');

            } catch (error) {
                console.error('Error:', error);
                showToast('Upload failed', 'error');
            }
            btn.disabled = false;
            btn.textContent = 'Submit';
        }

        // LEADERBOARD
        async function loadLeaderboard() {
            const snapshot = await db.collection('users').orderBy('points', 'desc').limit(20).get();
            const users = [];
            snapshot.forEach(doc => users.push({ id: doc.id, ...doc.data() }));
            renderLeaderboard(users);
            const rank = users.findIndex(u => u.id === currentUser.uid) + 1;
            document.getElementById('dash-rank').textContent = rank > 0 ? '#' + rank : '--';
        }

        function renderLeaderboard(users) {
            const podium = document.getElementById('podium');
            const top3 = users.slice(0, 3);
            const order = [top3[1], top3[0], top3[2]].filter(Boolean);
            const medals = ['ü•à', 'ü•á', 'ü•â'];

            podium.innerHTML = order.map((user, i) => {
                const initial = (user.name || 'U')[0].toUpperCase();
                const level = getUserLevel(user.points || 0);
                return `
                    <div class="podium-place">
                        <div class="podium-avatar">${initial}<span class="podium-medal">${medals[i]}</span></div>
                        <div class="podium-name">${user.name || 'Runner'}</div>
                        <div class="podium-level" style="font-size:11px;color:${level.color}">Lv${level.level} ${level.title}</div>
                        <div class="podium-points">${Math.round(user.points)} pts</div>
                        <div class="podium-bar"></div>
                    </div>
                `;
            }).join('');

            const list = document.getElementById('leaderboard-list');
            list.innerHTML = users.slice(3).map((user, i) => {
                const initial = (user.name || 'U')[0].toUpperCase();
                const isMe = user.id === currentUser?.uid;
                const level = getUserLevel(user.points || 0);
                const currentRank = i + 4;
                const prevRank = user.previousRank || currentRank;
                let trend = '';
                if (prevRank > currentRank) trend = `<span class="rank-trend up">‚ñ≤${prevRank - currentRank}</span>`;
                else if (prevRank < currentRank) trend = `<span class="rank-trend down">‚ñº${currentRank - prevRank}</span>`;

                return `
                    <div class="leaderboard-item ${isMe ? 'current-user' : ''}">
                        <div class="leaderboard-rank">${currentRank}${trend}</div>
                        <div class="leaderboard-avatar">${initial}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${user.name || 'Runner'}${isMe ? ' (You)' : ''}</div>
                            <div class="leaderboard-streak" style="display:flex;gap:8px;align-items:center;">
                                <span style="color:${level.color}">Lv${level.level}</span>
                                <span>${user.streak || 0}üî•</span>
                            </div>
                        </div>
                        <div class="leaderboard-points">${Math.round(user.points)}</div>
                    </div>
                `;
            }).join('');
        }

        // NAV
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(viewName + '-view').classList.add('active');
            event?.target?.closest('.nav-item')?.classList.add('active');
            if (viewName === 'leaderboard') loadLeaderboard();
            if (viewName === 'tasks') { renderPhaseTabs(); renderTasks(); }
            if (viewName === 'feed') loadActivityFeed();
        }

        function showToast(msg, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = 'toast show ' + type;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function shareProfile() {
            const text = `I have ${Math.round(userData?.points || 0)} points in the TF Jacksonville Challenge!`;
            if (navigator.share) {
                navigator.share({ text, url: window.location.href });
            } else {
                navigator.clipboard.writeText(text + ' ' + window.location.href);
                showToast('Link copied!', 'success');
            }
        }

        async function editName() {
            const newName = prompt('Enter your name:', userData.name || '');
            if (newName && newName.trim()) {
                try {
                    await db.collection('users').doc(currentUser.uid).update({
                        name: newName.trim()
                    });
                    userData.name = newName.trim();
                    updateUI();
                    showToast('Name updated!', 'success');
                } catch (error) {
                    showToast('Failed to update name', 'error');
                }
            }
        }

        async function completeDailyChallenge() {
            const today = new Date().toISOString().split('T')[0];
            const daily = dailyChallenges.find(d => d.date === today);
            if (!daily) return;

            // Check if already completed today
            if (userData.dailyCompleted?.includes(today)) {
                showToast('Already completed today!', 'error');
                return;
            }

            const btn = document.getElementById('daily-complete-btn');
            btn.disabled = true;
            btn.textContent = 'Completing...';

            try {
                const points = Math.round(daily.points * (userData.multiplier || 1));
                await db.collection('users').doc(currentUser.uid).update({
                    dailyCompleted: firebase.firestore.FieldValue.arrayUnion(today),
                    points: firebase.firestore.FieldValue.increment(points),
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                });

                userData.dailyCompleted = userData.dailyCompleted || [];
                userData.dailyCompleted.push(today);
                userData.points = (userData.points || 0) + points;

                updateUI();
                showToast(`+${points} daily bonus earned!`, 'success');
                btn.textContent = '‚úì Done';
                btn.style.background = 'rgba(100,255,150,0.3)';
                btn.style.color = '#64ff96';
            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to complete', 'error');
                btn.disabled = false;
                btn.textContent = 'Complete';
            }
        }

        // ============================================
        // CONFETTI SYSTEM
        // ============================================
        const Confetti = {
            colors: ['#4ecdc4', '#ffd700', '#ff6b6b', '#44a08d', '#fff', '#ff8c00'],
            shapes: ['circle', 'square', 'strip'],

            create(x) {
                const particle = document.createElement('div');
                const shape = this.shapes[Math.floor(Math.random() * this.shapes.length)];
                particle.className = 'confetti-particle ' + shape;
                particle.style.left = x + 'px';
                particle.style.backgroundColor = this.colors[Math.floor(Math.random() * this.colors.length)];
                particle.style.animationDuration = (Math.random() * 2 + 2) + 's';
                particle.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 4500);
            },

            burst(count = 60) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        this.create(Math.random() * window.innerWidth);
                    }, i * 30);
                }
            }
        };

        // ============================================
        // ACHIEVEMENT SYSTEM
        // ============================================
        const ACHIEVEMENTS = [
            { id: 'first_blood', name: 'First Blood', desc: 'Complete your first task', icon: 'üéØ', check: u => (u.completedTasks?.length || 0) >= 1 },
            { id: 'getting_started', name: 'Getting Started', desc: 'Complete 5 tasks', icon: '‚ö°', check: u => (u.completedTasks?.length || 0) >= 5 },
            { id: 'task_master', name: 'Task Master', desc: 'Complete 10 tasks', icon: 'üî•', check: u => (u.completedTasks?.length || 0) >= 10 },
            { id: 'unstoppable', name: 'Unstoppable', desc: 'Complete 25 tasks', icon: 'üí™', check: u => (u.completedTasks?.length || 0) >= 25 },
            { id: 'streak_3', name: 'On Fire', desc: '3-day streak', icon: 'üî•', check: u => (u.streak || 0) >= 3 },
            { id: 'streak_7', name: 'Week Warrior', desc: '7-day streak', icon: 'üìÖ', check: u => (u.streak || 0) >= 7 },
            { id: 'streak_14', name: 'Two Week Terror', desc: '14-day streak', icon: 'üóìÔ∏è', check: u => (u.streak || 0) >= 14 },
            { id: 'points_100', name: 'Century', desc: 'Earn 100 points', icon: 'üíØ', check: u => (u.points || 0) >= 100 },
            { id: 'points_500', name: 'High Roller', desc: 'Earn 500 points', icon: 'üíé', check: u => (u.points || 0) >= 500 },
            { id: 'points_1000', name: 'Thousand Club', desc: 'Earn 1000 points', icon: 'üèÜ', check: u => (u.points || 0) >= 1000 },
            { id: 'daily_5', name: 'Daily Devotee', desc: '5 daily challenges', icon: '‚òÄÔ∏è', check: u => (u.dailyCompleted?.length || 0) >= 5 },
            { id: 'hard_mode', name: 'Hard Mode', desc: '3 hard tasks', icon: 'üíÄ', check: u => tasks.filter(t => t.hard && u.completedTasks?.includes(t.id)).length >= 3 },
            { id: 'combo_master', name: 'Combo Master', desc: '3 tasks in 30 min', icon: '‚ö°', check: u => (u.maxCombo || 0) >= 3 },
            { id: 'all_phase_1', name: 'Phase 1 Complete', desc: 'Finish all Phase 1', icon: '1Ô∏è‚É£', check: u => tasks.filter(t => t.phase === 1).every(t => u.completedTasks?.includes(t.id)) },
            { id: 'uncomfortable', name: 'Comfort Zone Crusher', desc: 'All uncomfortable tasks', icon: 'ü¶Å', check: u => tasks.filter(t => t.category === 'uncomfortable').every(t => u.completedTasks?.includes(t.id)) },
        ];

        async function checkAchievements() {
            const userAch = userData.achievements || {};
            const newAchs = [];

            for (const ach of ACHIEVEMENTS) {
                if (!userAch[ach.id] && ach.check(userData)) {
                    newAchs.push(ach);
                    userAch[ach.id] = { unlockedAt: new Date().toISOString() };
                }
            }

            if (newAchs.length > 0) {
                await db.collection('users').doc(currentUser.uid).update({ achievements: userAch });
                userData.achievements = userAch;

                newAchs.forEach((ach, i) => {
                    setTimeout(() => showAchievementPopup(ach), i * 2000);
                });
            }
        }

        function showAchievementPopup(ach) {
            Confetti.burst(40);

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="ach-icon">${ach.icon}</div>
                <div>
                    <div class="ach-label">Achievement Unlocked!</div>
                    <div class="ach-name">${ach.name}</div>
                </div>
            `;
            document.body.appendChild(popup);

            setTimeout(() => popup.classList.add('show'), 100);
            setTimeout(() => {
                popup.classList.remove('show');
                setTimeout(() => popup.remove(), 400);
            }, 3500);
        }

        // ============================================
        // LEVEL SYSTEM
        // ============================================
        const LEVELS = [
            { level: 1, min: 0, title: 'Rookie Runner', color: '#888' },
            { level: 2, min: 50, title: 'Fundraising Novice', color: '#4ecdc4' },
            { level: 3, min: 150, title: 'Ask Master', color: '#44a08d' },
            { level: 4, min: 300, title: 'Donation Hunter', color: '#ffd700' },
            { level: 5, min: 500, title: 'Campaign Champion', color: '#ff8c00' },
            { level: 6, min: 750, title: 'Fundraising Elite', color: '#ff6b6b' },
            { level: 7, min: 1000, title: 'Legend', color: '#9b59b6' },
            { level: 8, min: 1500, title: 'TF All-Star', color: '#ffd700' }
        ];

        function getUserLevel(points) {
            return LEVELS.slice().reverse().find(l => points >= l.min) || LEVELS[0];
        }

        function getNextLevel(points) {
            return LEVELS.find(l => l.min > points);
        }

        function renderLevelBadge() {
            const level = getUserLevel(userData.points || 0);
            const next = getNextLevel(userData.points || 0);
            const progress = next ? ((userData.points - level.min) / (next.min - level.min)) * 100 : 100;

            return `
                <div class="level-badge" style="border-color: ${level.color}">
                    <span class="level-num">Lv ${level.level}</span>
                    <span class="level-title">${level.title}</span>
                </div>
                ${next ? `
                    <div class="level-progress"><div class="level-progress-fill" style="width: ${progress}%"></div></div>
                    <div class="level-next">${Math.round(next.min - userData.points)} pts to ${next.title}</div>
                ` : '<div class="level-next" style="color:#ffd700">MAX LEVEL!</div>'}
            `;
        }

        // ============================================
        // COMBO SYSTEM
        // ============================================
        const COMBO_WINDOW = 30 * 60 * 1000; // 30 minutes
        const COMBO_BONUSES = [
            { count: 2, bonus: 5, label: 'Double!' },
            { count: 3, bonus: 15, label: 'Triple!' },
            { count: 4, bonus: 25, label: 'Quad!' },
            { count: 5, bonus: 50, label: 'UNSTOPPABLE!' }
        ];

        async function handleCombo() {
            const now = Date.now();
            const lastTime = userData.lastTaskTime || 0;
            let combo = userData.comboCount || 0;
            let bonus = 0;

            if (now - lastTime < COMBO_WINDOW) {
                combo++;
                const tier = COMBO_BONUSES.find(c => c.count === Math.min(combo, 5));
                if (tier) {
                    bonus = tier.bonus;
                    showComboPopup(tier.label, bonus);
                }
            } else {
                combo = 1;
            }

            userData.comboCount = combo;
            userData.lastTaskTime = now;
            userData.maxCombo = Math.max(userData.maxCombo || 0, combo);

            await db.collection('users').doc(currentUser.uid).update({
                comboCount: combo,
                lastTaskTime: now,
                maxCombo: userData.maxCombo,
                points: firebase.firestore.FieldValue.increment(bonus)
            });

            if (bonus > 0) userData.points += bonus;
            return bonus;
        }

        function showComboPopup(label, bonus) {
            const popup = document.createElement('div');
            popup.className = 'combo-indicator';
            popup.innerHTML = `<div class="combo-label">${label}</div><div class="combo-bonus">+${bonus} bonus pts</div>`;
            document.body.appendChild(popup);

            setTimeout(() => popup.classList.add('show'), 50);
            setTimeout(() => {
                popup.classList.remove('show');
                setTimeout(() => popup.remove(), 300);
            }, 1500);
        }

        // ============================================
        // ACTIVITY FEED
        // ============================================
        async function postActivity(type, data) {
            try {
                await db.collection('activity').add({
                    userId: currentUser.uid,
                    userName: userData.name || 'Runner',
                    type,
                    ...data,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    reactions: { cheer: [], fire: [] }
                });
            } catch (e) { console.log('Activity post failed:', e); }
        }

        async function loadActivityFeed() {
            try {
                const snapshot = await db.collection('activity')
                    .orderBy('timestamp', 'desc')
                    .limit(30)
                    .get();

                const activities = [];
                snapshot.forEach(doc => activities.push({ id: doc.id, ...doc.data() }));
                renderActivityFeed(activities);
            } catch (e) {
                document.getElementById('activity-feed').innerHTML = '<div style="text-align:center;padding:40px;color:#888">Could not load feed</div>';
            }
        }

        function renderActivityFeed(activities) {
            if (activities.length === 0) {
                document.getElementById('activity-feed').innerHTML = '<div style="text-align:center;padding:40px;color:#888">No activity yet. Complete a task to get started!</div>';
                return;
            }

            const html = activities.map(a => {
                const isMe = a.userId === currentUser?.uid;
                const timeAgo = getTimeAgo(a.timestamp?.toDate?.());
                const initial = (a.userName || 'U')[0].toUpperCase();

                let action = '';
                if (a.type === 'task_complete') action = `completed <strong>${a.taskName || 'a task'}</strong>`;
                else if (a.type === 'achievement') action = `unlocked <strong>${a.achievementName}</strong>`;
                else if (a.type === 'level_up') action = `reached <strong>Level ${a.newLevel}</strong>`;
                else if (a.type === 'daily') action = `crushed the daily challenge`;

                const cheerCount = a.reactions?.cheer?.length || 0;
                const fireCount = a.reactions?.fire?.length || 0;
                const cheered = a.reactions?.cheer?.includes(currentUser?.uid);
                const fired = a.reactions?.fire?.includes(currentUser?.uid);

                return `
                    <div class="activity-item ${isMe ? 'is-me' : ''}">
                        <div class="activity-avatar">${initial}</div>
                        <div class="activity-content">
                            <div class="activity-text"><strong>${isMe ? 'You' : a.userName}</strong> ${action}</div>
                            <div class="activity-meta">
                                <span>${timeAgo}</span>
                                <span style="color:#4ecdc4">+${a.points || 0} pts</span>
                            </div>
                        </div>
                        <div class="activity-reactions">
                            <button class="reaction-btn ${cheered ? 'active' : ''}" onclick="addReaction('${a.id}','cheer')">üëè ${cheerCount || ''}</button>
                            <button class="reaction-btn ${fired ? 'active' : ''}" onclick="addReaction('${a.id}','fire')">üî• ${fireCount || ''}</button>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('activity-feed').innerHTML = html;
        }

        async function addReaction(activityId, type) {
            try {
                const ref = db.collection('activity').doc(activityId);
                const doc = await ref.get();
                const reactions = doc.data()?.reactions || { cheer: [], fire: [] };

                const arr = reactions[type] || [];
                const idx = arr.indexOf(currentUser.uid);
                if (idx > -1) arr.splice(idx, 1);
                else arr.push(currentUser.uid);

                reactions[type] = arr;
                await ref.update({ reactions });
                loadActivityFeed();
            } catch (e) { console.log('Reaction failed:', e); }
        }

        function getTimeAgo(date) {
            if (!date) return 'just now';
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }

        // ============================================
        // FLOATING POINTS ANIMATION
        // ============================================
        function showFloatingPoints(element, points) {
            const floater = document.createElement('div');
            floater.className = 'floating-points';
            floater.textContent = '+' + points;
            element.style.position = 'relative';
            element.appendChild(floater);
            setTimeout(() => floater.remove(), 1000);
        }
    </script>
</body>
</html>
